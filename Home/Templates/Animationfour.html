<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ask Anything Animation</title>
  <style>
    :root {
      --background-dark: #0a0a0a;
      --chat-background: rgba(18, 18, 18, 0.95);
      --user-message: rgba(0, 162, 255, 0.1);
      --ai-message: rgba(23, 23, 23, 0.9);
      --text-color: #ffffff;
      --input-background: rgba(30, 30, 30, 0.9);
      --glow-blue: #00a2ff;
      --border-color: rgba(0, 162, 255, 0.2);
      --glow-intensity: 0 0 15px;
      --shadow-color: rgba(0, 162, 255, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .Animation-four {
      background: var(--background-dark);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      padding: 20px;
    }

    .chatbox {
      width: 800px;
      height: 400px;
      background: var(--chat-background);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 30px var(--shadow-color);
      color: var(--text-color);
      position: relative;
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
    }

    .messages-container {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 70px;
      padding-right: 12px;
      scroll-behavior: smooth;
    }

    .messages-container::-webkit-scrollbar {
      width: 6px;
    }

    .messages-container::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
    }

    .messages-container::-webkit-scrollbar-thumb {
      background: var(--glow-blue);
      border-radius: 3px;
    }

    .message {
      display: flex;
      margin: 15px 0;
      align-items: flex-start;
      gap: 12px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.5s ease-out forwards;
    }

    .user {
      flex-direction: row-reverse;
      margin-left: auto;
    }

    .ai {
      flex-direction: row;
      margin-right: auto;
    }

    .user .bubble {
      background: var(--user-message);
      border: 1px solid var(--glow-blue);
      box-shadow: var(--glow-intensity) var(--shadow-color);
      border-radius: 15px 15px 0 15px;
    }

    .ai .bubble {
      background: var(--ai-message);
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 15px 15px 15px 0;
    }

    .bubble {
      padding: 12px 16px;
      max-width: 70%;
      word-wrap: break-word;
      font-size: 14px;
      line-height: 1.4;
      letter-spacing: 0.3px;
    }

    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border-color);
      box-shadow: var(--glow-intensity) var(--shadow-color);
      transition: transform 0.3s ease;
    }

    .avatar:hover {
      transform: scale(1.05);
    }

    .input-area {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      gap: 12px;
      background: var(--input-background);
      padding: 12px 15px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 15px var(--shadow-color);
      z-index: 1;
      backdrop-filter: blur(5px);
    }

    .input-area input {
      flex: 1;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .input-area input:focus {
      outline: none;
      border-color: var(--glow-blue);
      box-shadow: 0 0 10px var(--shadow-color);
    }

    .input-area input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    .message .bubble {
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }

    @media (max-width: 850px) {
      .Animation-four {
        padding: 10px;
      }

      .chatbox {
        width: 100%;
        max-width: 800px;
        height: 400px;
        padding: 15px;
      }
      
      .bubble {
        max-width: 85%;
        font-size: 13px;
        padding: 10px 14px;
      }
      
      .avatar {
        width: 34px;
        height: 34px;
      }

      .input-area {
        bottom: 15px;
        left: 15px;
        right: 15px;
        padding: 10px;
      }

      .input-area input {
        padding: 8px 12px;
        font-size: 13px;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(10px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .message {
      animation: slideIn 0.3s ease-out forwards;
    }

    @keyframes blink {
      0% { opacity: .2; }
      20% { opacity: 1; }
      100% { opacity: .2; }
    }

    .typing span {
      animation-name: blink;
      animation-duration: 1.4s;
      animation-iteration-count: infinite;
      animation-fill-mode: both;
    }

    .typing span:nth-child(2) {
      animation-delay: .2s;
    }

    .typing span:nth-child(3) {
      animation-delay: .4s;
    }
  </style>
</head>
<body>
  <div class="Animation-four" id="animation-four-container">
    <div class="chatbox" id="chatbox-animation-four">
      <div class="messages-container" id="messagesContainer-animation-four"></div>
      <div class="input-area">
        <input type="text" id="messageInput-animation-four" placeholder="Ask me anything..." disabled />
      </div>
    </div>
  </div>

  <script>
    (function() {
      class ChatAnimation {
        constructor() {
          this.initialized = false;
          this.initializationAttempts = 0;
          this.maxAttempts = 10;
          this.initializeWithRetry();
        }

        async initializeWithRetry() {
          if (this.initializationAttempts >= this.maxAttempts) {
            console.error('Failed to initialize chat animation');
            return;
          }

          if (this.initialized) return;

          const elements = this.checkElements();
          if (!elements) {
            this.initializationAttempts++;
            setTimeout(() => this.initializeWithRetry(), 500);
            return;
          }

          this.initializeComponents();
          this.initialized = true;
        }

        checkElements() {
          const chatbox = document.getElementById('chatbox-animation-four');
          const messageInput = document.getElementById('messageInput-animation-four');
          const messagesContainer = document.getElementById('messagesContainer-animation-four');

          if (!chatbox || !messageInput || !messagesContainer) {
            return false;
          }

          this.chatbox = chatbox;
          this.messageInput = messageInput;
          this.messagesContainer = messagesContainer;
          return true;
        }

        initializeComponents() {
          this.MAX_MESSAGES = 4;
          this.isAnimating = false;
          this.current = 0;
          this.isTyping = false;
          this.animationStarted = false;

          this.conversations = [
            {
              question: "What is artificial intelligence?",
              answer: "Artificial Intelligence (AI) is advanced computer technology that enables machines to simulate human intelligence, learning from experience and performing human-like tasks."
            },
            {
              question: "How do neural networks function?",
              answer: "Neural networks are AI systems modeled after the human brain, using interconnected nodes in layers to process data, learn patterns, and make intelligent decisions."
            },
            {
              question: "Explain machine learning",
              answer: "Machine learning is a branch of AI that allows systems to automatically learn and improve from experience without explicit programming, using data to identify patterns."
            },
            {
              question: "What is cloud computing?",
              answer: "Cloud computing delivers computing services—including storage, processing, and applications—over the internet, enabling flexible, scalable, and efficient resource usage."
            }
          ];

          this.avatars = {
            user: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
            ai: 'https://cdn-icons-png.flaticon.com/512/4712/4712100.png'
          };

          this.setupIntersectionObserver();
        }

        setupIntersectionObserver() {
          const observer = new IntersectionObserver(
            (entries) => {
              entries.forEach(entry => {
                if (entry.isIntersecting && !this.animationStarted) {
                  this.animationStarted = true;
                  this.startConversation();
                }
              });
            },
            { 
              threshold: 0.1,
              rootMargin: '50px'
            }
          );

          if (this.chatbox) {
            observer.observe(this.chatbox);
          }
        }

        async typeText(element, text) {
          let index = 0;
          element.textContent = '';
          
          return new Promise(resolve => {
            const interval = setInterval(() => {
              if (index < text.length) {
                element.textContent += text[index];
                index++;
              } else {
                clearInterval(interval);
                resolve();
              }
            }, 30);
          });
        }

        async simulateTyping(text) {
          this.messageInput.value = '';
          await this.typeText(this.messageInput, text);
          await new Promise(resolve => setTimeout(resolve, 300));
        }

        createMessageElement(content, sender) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `message ${sender}`;

          const avatar = document.createElement('img');
          avatar.className = 'avatar';
          avatar.src = this.avatars[sender];
          avatar.alt = `${sender} avatar`;

          const bubble = document.createElement('div');
          bubble.className = 'bubble';

          if (sender === 'user') {
            messageDiv.appendChild(bubble);
            messageDiv.appendChild(avatar);
          } else {
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
          }

          return { messageDiv, bubble };
        }

        async addMessage(content, sender) {
          const { messageDiv, bubble } = this.createMessageElement(content, sender);

          if (this.messagesContainer.children.length >= this.MAX_MESSAGES) {
            const firstMessage = this.messagesContainer.firstElementChild;
            firstMessage.style.animation = 'fadeOut 0.5s ease-out forwards';
            await new Promise(resolve => setTimeout(resolve, 500));
            firstMessage.remove();
          }

          this.messagesContainer.appendChild(messageDiv);
          messageDiv.style.animation = 'fadeIn 0.5s ease-out forwards';

          if (sender === 'ai') {
            await this.typeText(bubble, content);
          } else {
            bubble.textContent = content;
          }

          this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
        }

        async startConversation() {
          if (!this.initialized || this.current >= this.conversations.length || this.isAnimating) {
            return;
          }

          this.isAnimating = true;
          const conversation = this.conversations[this.current];

          try {
            await this.simulateTyping(conversation.question);
            await this.addMessage(conversation.question, 'user');
            this.messageInput.value = '';

            await new Promise(resolve => setTimeout(resolve, 500));
            await this.addMessage(conversation.answer, 'ai');

            this.current++;
            this.isAnimating = false;

            if (this.current < this.conversations.length) {
              setTimeout(() => this.startConversation(), 1000);
            }
          } catch (error) {
            console.error('Animation error:', error);
            this.isAnimating = false;
          }
        }
      }

      function initializeChatAnimation() {
        const container = document.getElementById('animation-four-container');
        if (container && !container.dataset.initialized) {
          container.dataset.initialized = 'true';
          new ChatAnimation();
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChatAnimation);
      } else {
        initializeChatAnimation();
      }

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.addedNodes.length) {
            initializeChatAnimation();
          }
        });
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    })();
  </script>
</body>
</html>
