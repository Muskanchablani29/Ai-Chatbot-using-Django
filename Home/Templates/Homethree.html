{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant Features</title>
    <style>
        
@property --angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.home-three {
    display: flex;
    min-height: 100vh;
    padding: 60px 80px;
    gap: 60px;
    align-items: center;
    justify-content: center;
    background: #0e0e0e;
}

.tool-list {
    display: flex;
    flex-direction: column;
    gap: 40px;
    perspective: 1000px;
    min-width: 250px;
    position: relative;
}

.tool-item {
    position: relative;
    font-size: 2rem;
    color: #777;
    cursor: pointer;
    transition: color 0.3s ease;
    padding: 10px 20px;
    overflow: hidden;
}

.tool-item span {
    position: relative;
    z-index: 2;
    transition: color 0.3s ease, text-shadow 0.3s ease;
}

.tool-item.active span {
    color: #00e5e5;
    text-shadow: 0 0 8px rgba(0, 229, 229, 0.5);
}

.tool-item::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -100%;
    width: 3px;
    height: 100%;
    background: #00e5e5;
    transform: translateY(-50%);
    transition: left 0.5s ease;
}

.tool-item.active::before {
    left: 100%;
}

.tool-display {
    flex: 1;
    position: relative;
    background: rgba(26, 26, 26, 0.95);
    padding: 25px;
    border-radius: 18px;
    box-shadow: 0 8px 32px rgba(0, 229, 229, 0.2);
    max-width: 900px;
    height: 500px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 1;
}

.tool-display::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 18px;
    padding: 2px;
    background: conic-gradient(
        from var(--angle),
        #00e5e5,
        #0099ff,
        #00e5e5
    );
    -webkit-mask: 
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: rotate-gradient 4s linear infinite;
}

@keyframes rotate-gradient {
    to { --angle: 360deg; }
}
    </style>
</head>
<body>
    <div class="home-three">
        {% csrf_token %}
        <div class="tool-list">
            <div class="tool-item"><span>Code Generator</span></div>
            <div class="tool-item"><span>Study Assistance</span></div>
            <div class="tool-item"><span>Mindful Journaling</span></div>
            <div class="tool-item"><span>üåç Ask Anything</span></div>
        </div>

        <div class="tool-display">
            <div class="tool-description" id="toolComponent"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tools = [
                {
                    title: "Code Generator",
                    templatePath: "{% url 'Home:Animationone' %}",
                    animationFunction: "startTypingAnimation"
                },
                {
                    title: "Study Assistance",
                    templatePath: "{% url 'Home:Animationtwo' %}",
                    animationFunction: "startAnimation"
                },
                {
                    title: "Mindful Journaling",
                    templatePath: "{% url 'Home:Animationthree' %}",
                    animationFunction: "startMessageAnimation"
                },
                {
                    title: "üåç Ask Anything",
                    templatePath: "{% url 'Home:Animationfour' %}"
                }
            ];

            let currentIndex = 0;
            const contentEl = document.getElementById("toolComponent");
            const toolItems = document.querySelectorAll(".tool-item");
            let rotationInterval;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            toolItems.forEach((item, index) => {
                item.addEventListener('click', () => activateTool(index));
            });

            async function activateTool(index) {
                clearInterval(rotationInterval);
                updateActiveState(index);
                startAutoRotation();
            }

            async function updateActiveState(index) {
                toolItems.forEach(item => item.classList.remove("active"));
                toolItems[index].classList.add("active");

                try {
                    const response = await fetch(tools[index].templatePath, {
                        headers: {
                            'X-CSRFToken': csrfToken,
                            'Accept': 'text/html'
                        },
                        credentials: 'same-origin'
                    });

                    if (!response.ok) throw new Error('Failed to load template');
                    const templateContent = await response.text();

                    contentEl.innerHTML = templateContent;

                    // Re-execute scripts in the loaded content
                    const scripts = contentEl.querySelectorAll('script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        if (script.src) {
                            newScript.src = script.src; // Copy external script src
                        } else {
                            newScript.textContent = script.textContent; // Copy inline script content
                        }
                        document.body.appendChild(newScript);
                        document.body.removeChild(newScript); // Remove after execution
                    });

                    // Trigger animation if defined
                    if (tools[index].animationFunction && typeof window[tools[index].animationFunction] === "function") {
                        console.log(`Calling animation function: ${tools[index].animationFunction}`);
                        window[tools[index].animationFunction]();
                    }
                } catch (error) {
                    console.error('Error loading template:', error);
                    contentEl.innerHTML = '<p>Error loading content. Please try again.</p>';
                }
            }

            function autoRotate() {
                currentIndex = (currentIndex + 1) % tools.length; // Ensure cycling through all tools
                updateActiveState(currentIndex);
            }

            function startAutoRotation() {
                if (rotationInterval) clearInterval(rotationInterval);
                rotationInterval = setInterval(autoRotate, 7000); // Extended timing to 7 seconds
            }

            updateActiveState(0);
            startAutoRotation();
        });
    </script>
</body>
</html>
